<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calcolo Mutuo</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f7f7f7;
        }
        
        .container {
            max-width: 400px;
            width: 100%;
            padding: 20px;
            border-radius: 8px;
            background-color: #fff;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
        }

        .field-group {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
        }

        label {
            margin-bottom: 5px;
            font-size: 14px;
            color: #333;
        }

        input, select {
            padding: 8px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box;
        }

        .btn {
            margin-top: 15px;
            padding: 10px;
            font-size: 16px;
            border: none;
            border-radius: 4px;
            color: white;
            background-color: #28a745;
            cursor: pointer;
            width: 100%;
        }

        .btn:hover {
            background-color: #218838;
        }

        #risultatoConvenienza, #risultatoRapporto {
            margin-top: 10px;
            font-size: 14px;
            text-align: center;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>Calcolo Convenienza Mutuo</h2>

    <!-- Campo per la rata variabile -->
    <div class="field-group">
        <label for="rataVariabile">Rata mensile attuale (€):</label>
        <input type="number" id="rataVariabile" placeholder="Es. 500" required>
    </div>

    <!-- Campo per il tasso variabile -->
    <div class="field-group">
        <label for="tassoVariabile">Tasso di interesse attuale (%):</label>
        <input type="number" id="tassoVariabile" placeholder="Es. 3.5">
    </div>

    <!-- Campo per la durata del mutuo -->
    <div class="field-group">
        <label for="durataMutuo">Durata residua del mutuo (anni):</label>
        <input type="number" id="durataMutuo" placeholder="Es. 15" required>
    </div>

    <!-- Campo per il tipo di lavoro -->
    <div class="field-group">
        <label for="tipoLavoro">Tipo di lavoro:</label>
        <select id="tipoLavoro" required>
            <option value="">Seleziona</option>
            <option value="Autonomo">Autonomo</option>
            <option value="Tempo Indeterminato">Tempo Indeterminato</option>
            <option value="Tempo Determinato">Tempo Determinato</option>
        </select>
    </div>

    <!-- Campo per il reddito mensile -->
    <div class="field-group">
        <label for="redditoMensile">Reddito mensile (€):</label>
        <input type="number" id="redditoMensile" placeholder="Es. 2500">
    </div>

    <!-- Campo per il reddito annuale -->
    <div class="field-group">
        <label for="redditoAnnuale">Reddito annuale (€):</label>
        <input type="number" id="redditoAnnuale" placeholder="Es. 30000">
    </div>

    <!-- Campo per altri impegni mensili -->
    <div class="field-group">
        <label for="altriImpegni">Altri impegni mensili (€):</label>
        <input type="number" id="altriImpegni" placeholder="Es. 200">
    </div>

    <!-- Pulsante per calcolare la convenienza -->
    <button class="btn" onclick="calcolaConvenienza()">Calcola Convenienza</button>
    <div id="risultatoConvenienza"></div>

    <!-- Pulsante per calcolare il rapporto rata/reddito -->
    <button class="btn" onclick="calcolaRapportoRataReddito()">Calcola Rapporto Rata/Reddito</button>
    <div id="risultatoRapporto"></div>

    <!-- Pulsante per inviare su WhatsApp -->
    <button class="btn" onclick="inviaWhatsApp()">Invia tramite WhatsApp</button>

</div>

<script>
    function calcolaConvenienza() {
        const rataVariabile = parseFloat(document.getElementById('rataVariabile').value);
        const tassoVariabile = parseFloat(document.getElementById('tassoVariabile').value) || 4.5;
        const durataMutuo = parseInt(document.getElementById('durataMutuo').value);

        const capitaleResiduo = (rataVariabile * (1 - Math.pow(1 + tassoVariabile / 100 / 12, -durataMutuo * 12))) / (tassoVariabile / 100 / 12);
        const rataFissa = capitaleResiduo * (3 / 100 / 12) / (1 - Math.pow(1 + 3 / 100 / 12, -durataMutuo * 12));

        const totalePagatoAttuale = rataVariabile * durataMutuo * 12;
        const totalePagatoFisso = rataFissa * durataMutuo * 12;
        const risparmioTotale = totalePagatoAttuale - totalePagatoFisso;
        const differenzaMensile = rataVariabile - rataFissa;
        const differenzaAnnuale = differenzaMensile * 12;

        document.getElementById('risultatoConvenienza').innerHTML = `
            Totale pagato con l'attuale mutuo: €${totalePagatoAttuale.toLocaleString('it-IT', { maximumFractionDigits: 0 })}<br>
            Totale pagato con il mutuo rinegoziato con tasso fisso: €${totalePagatoFisso.toLocaleString('it-IT', { maximumFractionDigits: 0 })}<br>
            Risparmio totale: €${risparmioTotale.toLocaleString('it-IT', { maximumFractionDigits: 0 })}<br>
            Differenza mensile tra vecchio mutuo e nuovo mutuo: €${differenzaMensile.toLocaleString('it-IT', { maximumFractionDigits: 0 })}<br>
            Differenza annuale tra rata vecchio mutuo e nuovo mutuo: €${differenzaAnnuale.toLocaleString('it-IT', { maximumFractionDigits: 0 })}<br><br>
            <strong>Spiegazione del risparmio:</strong><br>
            Il risparmio è calcolato con un nuovo mutuo a tasso fisso. Con il tasso fisso si ottiene una maggiore sicurezza nel lungo periodo, riducendo l'impatto di eventuali aumenti futuri dei tassi di interesse. La domanda di rinegoziazione delle condizioni del mutuo è subordinata all'analisi del credito.
        `;
    }

    function calcolaRapportoRataReddito() {
        const rataVariabile = parseFloat(document.getElementById('rataVariabile').value);
        const redditoMensile = parseFloat(document.getElementById('redditoMensile').value);

        if (!isNaN(rataVariabile) && !isNaN(redditoMensile) && redditoMensile > 0) {
            const rapporto = (rataVariabile / redditoMensile) * 100;
            document.getElementById('risultatoRapporto').innerHTML = `Rapporto Rata/Reddito: ${rapporto.toFixed(2)}%`;
        } else {
            document.getElementById('risultatoRapporto').innerHTML = 'Inserisci valori validi per la rata e il reddito.';
        }
    }

    function inviaWhatsApp() {
        const rataVariabile = document.getElementById('rataVariabile').value;
        const tassoVariabile = document.getElementById('tassoVariabile').value;
        const durataMutuo = document.getElementById('durataMutuo').value;
        const tipoLavoro = document.getElementById('tipoLavoro').value;
        const redditoMensile = document.getElementById('redditoMensile').value;
        const redditoAnnuale = document.getElementById('redditoAnnuale').value;
        const altriImpegni = document.getElementById('altriImpegni').value;

                let messaggio = "Ecco i dati per la rinegoziazione del mutuo:%0A";
        
        if (rataVariabile) {
            messaggio += `- Rata mensile attuale: €${rataVariabile}%0A`;
        }
        if (tassoVariabile) {
            messaggio += `- Tasso di interesse attuale: ${tassoVariabile}%0A`;
        }
        if (durataMutuo) {
            messaggio += `- Durata residua del mutuo: ${durataMutuo} anni%0A`;
        }
        if (tipoLavoro) {
            messaggio += `- Tipo di lavoro: ${tipoLavoro}%0A`;
        }
        if (redditoMensile) {
            messaggio += `- Reddito mensile: €${redditoMensile}%0A`;
        }
        if (redditoAnnuale) {
            messaggio += `- Reddito annuale: €${redditoAnnuale || "non specificato"}%0A`;
        }
        if (altriImpegni) {
            messaggio += `- Altri impegni mensili: €${altriImpegni}%0A`;
        }

        messaggio += "%0A" + "Puoi aiutarmi a risparmiare?";

        const whatsappUrl = `https://wa.me/?text=${messaggio}`;
        window.open(whatsappUrl, "_blank");
    }
</script>
